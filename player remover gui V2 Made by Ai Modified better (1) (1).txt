-- LocalScript inside StarterPlayerScripts

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- GUI Setup
local playerGui = LocalPlayer:WaitForChild("PlayerGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MultiHidePlayerGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Rainbow function
local function getRainbowColor(t)
    local r = math.sin(t) * 0.5 + 0.5
    local g = math.sin(t + 2) * 0.5 + 0.5
    local b = math.sin(t + 4) * 0.5 + 0.5
    return Color3.new(r, g, b)
end

-- Toggle GUI Button
local toggleGuiButton = Instance.new("TextButton")
toggleGuiButton.Size = UDim2.new(0, 30, 0, 30)
toggleGuiButton.Position = UDim2.new(0, 10, 0, 10)
toggleGuiButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
toggleGuiButton.Text = "X"
toggleGuiButton.TextColor3 = Color3.new(1, 1, 1)
toggleGuiButton.TextScaled = true
toggleGuiButton.Draggable = true
toggleGuiButton.Parent = screenGui

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 140, 0, 190)
frame.Position = UDim2.new(0.5, -70, 0.5, -95)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true
frame.Visible = true
frame.Parent = screenGui

-- Username boxes
local usernameBoxes = {}
for i = 1, 4 do
    local box = Instance.new("TextBox")
    box.Size = UDim2.new(0.9, 0, 0, 25)
    box.Position = UDim2.new(0.05, 0, 0, 10 + (i - 1) * 30)
    box.PlaceholderText = "User " .. i
    box.Text = ""
    box.TextScaled = true
    box.Parent = frame
    table.insert(usernameBoxes, box)
end

-- Toggle button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0.9, 0, 0, 30)
toggleButton.Position = UDim2.new(0.05, 0, 0, 135)
toggleButton.Text = "Toggle: OFF"
toggleButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50) -- brighter red
toggleButton.TextScaled = true
toggleButton.Parent = frame

-- Clear button
local clearButton = Instance.new("TextButton")
clearButton.Size = UDim2.new(0.3, 0, 0, 20)
clearButton.Position = UDim2.new(0.65, 0, 0, 165)
clearButton.Text = "Clear"
clearButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
clearButton.TextScaled = true
clearButton.Parent = frame

-- State
local hiddenPlayers = {}
local isHidden = false
local originalParts = {}
local guiVisible = true

-- Hide player client-side
local function hidePlayer(player)
    if not player.Character then return end
    originalParts[player] = {}

    for _, part in ipairs(player.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            originalParts[player][part] = {
                Anchored = part.Anchored,
                CFrame = part.CFrame,
                Transparency = part.Transparency
            }
            part.Anchored = true
            part.CFrame = CFrame.new(1_000_000, 1_000_000, 1_000_000)
            part.Transparency = 1
            part.CanCollide = false
        elseif part:IsA("Decal") then
            part.Transparency = 1
        elseif part:IsA("BillboardGui") then
            part.Enabled = false
        end
    end
end

-- Restore player
local function restorePlayer(player)
    if not player.Character or not originalParts[player] then return end

    for part, data in pairs(originalParts[player]) do
        if part and part:IsDescendantOf(player.Character) then
            part.Anchored = data.Anchored
            part.CFrame = data.CFrame
            part.Transparency = data.Transparency
            part.CanCollide = true
        end
    end

    for _, part in ipairs(player.Character:GetDescendants()) do
        if part:IsA("Decal") then
            part.Transparency = 0
        elseif part:IsA("BillboardGui") then
            part.Enabled = true
        end
    end

    originalParts[player] = nil
end

-- Toggle logic
toggleButton.MouseButton1Click:Connect(function()
    if not isHidden then
        hiddenPlayers = {}
        for _, box in ipairs(usernameBoxes) do
            local username = box.Text
            local targetPlayer = Players:FindFirstChild(username)
            if targetPlayer then
                hidePlayer(targetPlayer)
                table.insert(hiddenPlayers, targetPlayer)
            end
        end
        toggleButton.Text = "Toggle: ON"
        toggleButton.BackgroundColor3 = Color3.fromRGB(50, 255, 50) -- brighter green
        isHidden = true
    else
        for _, player in ipairs(hiddenPlayers) do
            restorePlayer(player)
        end
        hiddenPlayers = {}
        toggleButton.Text = "Toggle: OFF"
        toggleButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50) -- brighter red
        isHidden = false
    end
end)

-- Clear logic
clearButton.MouseButton1Click:Connect(function()
    for _, box in ipairs(usernameBoxes) do
        box.Text = ""
    end
end)

-- GUI toggle logic
toggleGuiButton.MouseButton1Click:Connect(function()
    guiVisible = not guiVisible
    frame.Visible = guiVisible
    if guiVisible then
        toggleGuiButton.Text = "X"
        toggleGuiButton.Size = UDim2.new(0, 30, 0, 30)
    else
        toggleGuiButton.Text = "‚óè"
        toggleGuiButton.Size = UDim2.new(0, 20, 0, 20)
    end
end)

-- Rainbow animation loop
RunService.RenderStepped:Connect(function(dt)
    local t = tick()
    if not guiVisible then
        toggleGuiButton.BackgroundColor3 = getRainbowColor(t)
    end
    clearButton.BackgroundColor3 = getRainbowColor(t + 1)
end)